<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="learn javascript by www.liaoxuefeng.com">
  <title>Vue</title>
  <link rel="stylesheet" href="/static/css/bootstrap.css">
  <script src="/static/js/vue.js"></script>
  <script src="/static/js/axios.min.js"></script>
</head>

<body>

  <div id="app" class="container">
    <div class="row">
      <div class="col-md-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title"><span class="glyphicon glyphicon-th-list"></span> MVVM</h3>
          </div>
          <div class="panel-body">
            <div>
              <h3>{{ title }}</h3>
              <p v-if="loading">Loading...</p>
              <ol>
                <li v-for="t in todos">
                  <dl>
                    <dt contenteditable="true" v-on:blur="update(t, 'name', $event)">{{ t.name }}
                    </dt>
                    <dd contenteditable="true" v-on:blur="update(t, 'description', $event)">
                      {{ t.description }}</dd>
                    <dd><a href="#0" v-on:click="remove(t)">Delete</a></dd>
                  </dl>
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title"><span class="glyphicon glyphicon-plus"></span> Add New Todo</h3>
          </div>
          <div class="panel-body">
            <form id="vmAdd" action="#0" v-on:submit.prevent="submit">
              <div class="form-group">
                <label>Name:</label>
                <input type="text" v-model="name" class="form-control" placeholder="Enter name">
              </div>
              <div class="form-group">
                <label>Description:</label>
                <input type="text" v-model="description" class="form-control" placeholder="Enter description">
              </div>
              <button type="submit" class="btn btn-default">Add</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <h1>Get more courses...</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">JavaScript</h3>
          </div>
          <div class="panel-body">
            <p>full-stack JavaScript course</p>
            <p><a target="_blank"
                href="http://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000">Read
                more</a></p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Python</h3>
          </div>
          <div class="panel-body">
            <p>the latest Python course</p>
            <p><a target="_blank"
                href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000">Read
                more</a></p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">git</h3>
          </div>
          <div class="panel-body">
            <p>A course about git version control</p>
            <p><a target="_blank"
                href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000">Read
                more</a></p>
          </div>
        </div>
      </div>
    </div>

    <footer style="text-align: center;position: fixed;bottom: 20px;width: 100%;">
      <a style="color: #999;" href="http://www.beian.miit.gov.cn/">浙ICP备20021091号</a>
    </footer>
  </div>

  <script>

    function showError(resp) {
      console.log('Error: ' + resp);
    }

    axios.interceptors.response.use((response) => {
      const res = response.data
      return res;
    });

    var vm = new Vue({
      el: '#app',
      http: {
        timeout: 5000
      },
      data: {
        title: 'TODO List',
        todos: [],
        loading: false,
        name: '',
        description: ''
      },
      created: function () {
        this.init();
      },
      methods: {
        submit: function () {
          vm.create(this.$data);
        },
        init: function () {
          var that = this;
          that.loading = true;
          axios({
            url: '/api/todos',
            method: 'get',
            params: { pageIndex: 1, pageSize: 10 }
          }).then((res) => {
            that.loading = false;
            that.todos = res.todos;
          }).catch(function (res) {
            that.loading = false;
            showError(res);
          });
        },
        create: function (todo) {
          axios({
            url: '/api/todos',
            method: 'post',
            data: todo
          }).then((res) => {
            this.name = '';
            this.description = '';
            this.todos.push(res)
          }).catch(function (res) {
            showError(res);
          });
        },
        update: function (todo, prop, e) {
          var data = {
            name: todo.name,
            description: todo.description
          };
          t[prop] = e.target.innerText;
          if (t[prop] === todo[prop]) {
            return;
          }
          axios({
            url: '/api/todos/' + todo.id,
            method: 'update',
            data,
          }).then((res) => {
            todo.name = res.name;
            todo.description = res.description;
          }).catch(function (res) {
            e.target.innerText = todo[prop];
            showError(res);
          });
        },
        remove: function (todo) {
          axios({
            url: '/api/todos/' + todo.id,
            method: 'delete',
          }).then((res) => {
            var i, index = -1;
            let todos = this.todos;
            let _length = todos.length;
            for (i = 0; i < _length; i++) {
              if (todos[i].id === todo.id) {
                index = i;
                break;
              }
            }
            if (index >= 0) {
              todos.splice(index, 1);
            }
          }).catch(function (res) {
            showError(res);
          });
        }
      }
    });
    window.vm = vm;

  </script>
</body>

</html>